# MedChina éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°† MedChina åŒ»ç–—æ—…æ¸¸æ™ºèƒ½ä½“ç³»ç»Ÿéƒ¨ç½²åˆ°å…è´¹æœåŠ¡å™¨ä¸Šã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [éƒ¨ç½²å¹³å°é€‰æ‹©](#éƒ¨ç½²å¹³å°é€‰æ‹©)
- [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)
  - [æ–¹æ¡ˆä¸€ï¼šRenderï¼ˆæ¨èæ–°æ‰‹ï¼‰](#æ–¹æ¡ˆä¸€-renderæ¨èæ–°æ‰‹)
  - [æ–¹æ¡ˆäºŒï¼šRailwayï¼ˆæ¨èï¼‰](#æ–¹æ¡ˆäºŒ-railwayæ¨è)
  - [æ–¹æ¡ˆä¸‰ï¼šFly.ioï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰](#æ–¹æ¡ˆä¸‰-flyioåŠŸèƒ½å¼ºå¤§)
  - [æ–¹æ¡ˆå››ï¼šæœ¬åœ° Docker éƒ¨ç½²](#æ–¹æ¡ˆå››æœ¬åœ°-docker-éƒ¨ç½²)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [æ•°æ®åº“åˆå§‹åŒ–](#æ•°æ®åº“åˆå§‹åŒ–)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. ä¸€ä¸ª GitHub è´¦å·
2. æœ¬åœ°å®‰è£… Git
3. ï¼ˆå¯é€‰ï¼‰å·²ç”³è¯· Coze API Key

### æœ€ç®€éƒ¨ç½²æ­¥éª¤ï¼ˆæ¨èä½¿ç”¨ Railwayï¼‰

1. è®¿é—® https://railway.app å¹¶ç™»å½•
2. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
3. é€‰æ‹©æ‚¨çš„ MedChina ä»“åº“
4. Railway ä¼šè‡ªåŠ¨æ£€æµ‹ Dockerfile å¹¶å¼€å§‹éƒ¨ç½²
5. ç­‰å¾…çº¦ 3-5 åˆ†é’Ÿï¼Œéƒ¨ç½²å®Œæˆ
6. ç‚¹å‡»ç”Ÿæˆçš„ URL è®¿é—®æ‚¨çš„åº”ç”¨

## ğŸ¯ éƒ¨ç½²å¹³å°é€‰æ‹©

| å¹³å° | å…è´¹é¢åº¦ | æ•°æ®åº“ | è‡ªå®šä¹‰åŸŸå | éš¾åº¦ | æ¨èæŒ‡æ•° |
|------|---------|--------|----------|------|---------|
| **Railway** | $5/æœˆé¢åº¦ | âœ… å…è´¹ PostgreSQL | âœ… | â­ | â­â­â­â­â­ |
| **Render** | 750å°æ—¶/æœˆ | âœ… å…è´¹å®ä¾‹ | âœ… | â­â­ | â­â­â­â­ |
| **Fly.io** | $5/æœˆé¢åº¦ | âœ… æŒ‚è½½å·éœ€ä»˜è´¹ | âœ… | â­â­â­ | â­â­â­â­ |
| **Vercel** | æ— é™åˆ¶ | âŒ éœ€å¤–éƒ¨æ•°æ®åº“ | âœ… | â­ | â­â­â­ |

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

---

## æ–¹æ¡ˆä¸€ï¼šRenderï¼ˆæ¨èæ–°æ‰‹ï¼‰

### ä¼˜ç‚¹
- å®Œå…¨å…è´¹ï¼ˆ750 å°æ—¶/æœˆï¼‰
- å†…ç½® PostgreSQL æ•°æ®åº“
- è‡ªåŠ¨ HTTPS
- æ“ä½œç®€å•

### ç¼ºç‚¹
- å†·å¯åŠ¨è¾ƒæ…¢ï¼ˆé¦–æ¬¡è®¿é—®éœ€ 30-60 ç§’ï¼‰
- å…è´¹ç‰ˆé™åˆ¶è¾ƒå¤š

### éƒ¨ç½²æ­¥éª¤

#### 1. æ³¨å†Œå¹¶ç™»å½• Render
è®¿é—® https://render.com æ³¨å†Œè´¦å·ï¼ˆå»ºè®®ä½¿ç”¨ GitHub ç™»å½•ï¼‰

#### 2. åˆ›å»ºæ•°æ®åº“æœåŠ¡
1. ç‚¹å‡» Dashboard â†’ "New +"
2. é€‰æ‹© "PostgreSQL"
3. å¡«å†™é…ç½®ï¼š
   - Name: `medchina-db`
   - Database: `medchina`
   - User: `meduser`
   - Region: `Oregon (US West)`
4. ç‚¹å‡» "Create Database"
5. ç­‰å¾…æ•°æ®åº“åˆ›å»ºå®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
6. è®°ä¸‹ `Internal Database URL`

#### 3. åˆ›å»º Web æœåŠ¡
1. ç‚¹å‡» "New +" â†’ "Web Service"
2. è¿æ¥æ‚¨çš„ GitHub ä»“åº“
3. é…ç½®æœåŠ¡ï¼š
   - Name: `medchina-web`
   - Region: `Oregon (US West)`
   - Branch: `main`
   - Runtime: `Docker`
   - Docker Context: `/`
   - Dockerfile Path: `./Dockerfile`

4. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆä»æ•°æ®åº“å¤åˆ¶ï¼‰ï¼š
   ```
   DATABASE_URL=<ä»æ•°æ®åº“æœåŠ¡å¤åˆ¶çš„ Internal Database URL>
   SECRET_KEY=<ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²>
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=1440
   COZE_WORKLOAD_IDENTITY_API_KEY=<æ‚¨çš„ Coze API Key>
   COZE_INTEGRATION_MODEL_BASE_URL=https://api.coze.com
   ```

5. ç‚¹å‡» "Create Web Service"
6. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰

#### 4. è®¿é—®åº”ç”¨
- éƒ¨ç½²æˆåŠŸåï¼ŒRender ä¼šæä¾›ä¸€ä¸ª HTTPS URL
- è®¿é—®: `https://medchina-web.onrender.com`

---

## æ–¹æ¡ˆäºŒï¼šRailwayï¼ˆæ¨èï¼‰

### ä¼˜ç‚¹
- $5/æœˆå…è´¹é¢åº¦ï¼ˆå¤Ÿç”¨ï¼‰
- è‡ªåŠ¨é…ç½®æ•°æ®åº“
- å®æ—¶æ—¥å¿—
- æ€§èƒ½è¾ƒå¥½

### ç¼ºç‚¹
- å…è´¹é¢åº¦ç”¨å®Œä¼šæš‚åœæœåŠ¡

### éƒ¨ç½²æ­¥éª¤

#### 1. æ³¨å†Œå¹¶ç™»å½• Railway
è®¿é—® https://railway.app æ³¨å†Œè´¦å·

#### 2. åˆ›å»ºæ–°é¡¹ç›®
1. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
2. é€‰æ‹©æ‚¨çš„ MedChina ä»“åº“
3. Railway ä¼šè‡ªåŠ¨è¯†åˆ« Dockerfile å’Œ `railway.toml`

#### 3. é…ç½®ç¯å¢ƒå˜é‡
åœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
SECRET_KEY=<ç”Ÿæˆéšæœºå­—ç¬¦ä¸²>
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
COZE_WORKLOAD_IDENTITY_API_KEY=<æ‚¨çš„ Coze API Key>
COZE_INTEGRATION_MODEL_BASE_URL=https://api.coze.com
```

Railway ä¼šè‡ªåŠ¨é…ç½® DATABASE_URLã€‚

#### 4. éƒ¨ç½²
ç‚¹å‡» "Deploy"ï¼ŒRailway ä¼šè‡ªåŠ¨ï¼š
- åˆ›å»º PostgreSQL æ•°æ®åº“
- æ„å»ºå¹¶éƒ¨ç½²åº”ç”¨
- é…ç½®åŸŸåå’Œ HTTPS

#### 5. è®¿é—®åº”ç”¨
- éƒ¨ç½²å®Œæˆåï¼ŒRailway ä¼šæä¾›è®¿é—® URL
- æ ¼å¼: `https://medchina-app.up.railway.app`

---

## æ–¹æ¡ˆä¸‰ï¼šFly.ioï¼ˆåŠŸèƒ½å¼ºå¤§ï¼‰

### ä¼˜ç‚¹
- å…¨çƒéƒ¨ç½²
- æ›´å¥½çš„æ€§èƒ½
- æ”¯æŒ Docker

### ç¼ºç‚¹
- é…ç½®è¾ƒå¤æ‚
- æ•°æ®åº“éœ€å•ç‹¬é…ç½®

### éƒ¨ç½²æ­¥éª¤

#### 1. å®‰è£… Fly CLI
```bash
# macOS
brew install flyctl

# Linux
curl -L https://fly.io/install.sh | sh

# Windows (ä½¿ç”¨ PowerShell)
iwr https://fly.io/install.ps1 -useb | iex
```

#### 2. ç™»å½• Fly.io
```bash
flyctl auth login
```

#### 3. å¯åŠ¨åº”ç”¨
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
flyctl launch
```

æŒ‰ç…§æç¤ºå®Œæˆé…ç½®ï¼Œæˆ–ä½¿ç”¨é¢„é…ç½®çš„ `fly.toml`ã€‚

#### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
flyctl secrets set SECRET_KEY="your-secret-key"
flyctl secrets set COZE_WORKLOAD_IDENTITY_API_KEY="your-api-key"
```

#### 5. åˆ›å»ºæ•°æ®åº“
```bash
flyctl postgres create --name medchina-db
flyctl postgres attach --app medchina-app medchina-db
```

#### 6. éƒ¨ç½²
```bash
flyctl deploy
```

---

## æ–¹æ¡ˆå››ï¼šæœ¬åœ° Docker éƒ¨ç½²

### é€‚ç”¨åœºæ™¯
- æœ¬åœ°å¼€å‘æµ‹è¯•
- æ¼”ç¤ºç¯å¢ƒ
- æœåŠ¡å™¨è‡ªæ‰˜ç®¡

### éƒ¨ç½²æ­¥éª¤

#### 1. å®‰è£… Docker å’Œ Docker Compose
è®¿é—® https://docs.docker.com/get-docker/ ä¸‹è½½å®‰è£…

#### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦é…ç½®
```

#### 3. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“
```bash
docker-compose exec app bash /app/scripts/init_db.sh
```

#### 5. è®¿é—®åº”ç”¨
- å‰å°: http://localhost:8000
- åå°ç®¡ç†: http://localhost:8000/admin/
- API æ–‡æ¡£: http://localhost:8000/docs

---

## âš™ï¸ ç¯å¢ƒé…ç½®

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `DATABASE_URL` | PostgreSQL æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@host:5432/db` |
| `SECRET_KEY` | JWT ç­¾åå¯†é’¥ | `your-long-random-secret-key-here` |
| `ALGORITHM` | åŠ å¯†ç®—æ³• | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Token è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ | `1440` (24å°æ—¶) |
| `COZE_WORKLOAD_IDENTITY_API_KEY` | Coze API å¯†é’¥ | ä» Coze å¹³å°è·å– |
| `COZE_INTEGRATION_MODEL_BASE_URL` | Coze API åœ°å€ | `https://api.coze.com` |

### ç”Ÿæˆ SECRET_KEY
```bash
# Linux/Mac
openssl rand -hex 32

# Python
python -c "import secrets; print(secrets.token_hex(32))"
```

---

## ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–

é¦–æ¬¡éƒ¨ç½²åï¼Œéœ€è¦åˆ›å»ºæ•°æ®åº“è¡¨ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨åˆå§‹åŒ–è„šæœ¬
```bash
# Docker ç¯å¢ƒ
docker-compose exec app bash scripts/init_db.sh

# Railwayï¼ˆåœ¨ Railway Console çš„ç»ˆç«¯ä¸­æ‰§è¡Œï¼‰
python scripts/init_db.sh
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è¿è¡Œè¿ç§»
```bash
# å®‰è£… Alembicï¼ˆå¦‚æœä½¿ç”¨ï¼‰
pip install alembic

# è¿è¡Œè¿ç§»
alembic upgrade head
```

### æ–¹æ³•ä¸‰ï¼šé€šè¿‡ API åˆ›å»º
è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œåº”ç”¨ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ï¼š
```bash
curl http://your-domain/health
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: éƒ¨ç½²åæ— æ³•è®¿é—®ï¼Ÿ
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆæŸ¥çœ‹å¹³å°æ—¥å¿—ï¼‰
2. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 8000 ç«¯å£
3. åŸŸå DNS è§£ææ˜¯å¦æ­£ç¡®

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
**A**: ç¡®è®¤ï¼š
1. DATABASE_URL æ ¼å¼æ­£ç¡®
2. æ•°æ®åº“æœåŠ¡å·²å¯åŠ¨
3. ç½‘ç»œè¿æ¥æ­£å¸¸

### Q3: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ
**å¹³å°æ—¥å¿—æŸ¥çœ‹æ–¹å¼ï¼š**
- **Render**: Dashboard â†’ Logs
- **Railway**: Project â†’ Logs tab
- **Fly.io**: `flyctl logs`
- **Docker**: `docker-compose logs -f`

### Q4: å¦‚ä½•æ›´æ–°åº”ç”¨ï¼Ÿ
**è‡ªåŠ¨éƒ¨ç½²ï¼š**
1. æ¨é€ä»£ç åˆ° GitHub
2. å¹³å°ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é‡æ–°éƒ¨ç½²

**æ‰‹åŠ¨éƒ¨ç½²ï¼š**
```bash
# Fly.io
flyctl deploy

# Docker
docker-compose up -d --build
```

### Q5: å…è´¹é¢åº¦ç”¨å®Œäº†æ€ä¹ˆåŠï¼Ÿ
**A**: å…è´¹å¹³å°æ¯æœˆæœ‰é™é¢ï¼š
- **Render**: 750 å°æ—¶/æœˆï¼ˆçº¦æ¯å¤© 24 å°æ—¶ï¼‰
- **Railway**: $5/æœˆ
- **Fly.io**: $5/æœˆ

ç”¨å®Œä¼šè‡ªåŠ¨æš‚åœï¼Œä¸‹æœˆé‡ç½®ï¼Œæˆ–å‡çº§ä»˜è´¹ã€‚

### Q6: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰åŸŸåï¼Ÿ
**å„å¹³å°é…ç½®ï¼š**
- **Render**: Settings â†’ Custom Domains
- **Railway**: Settings â†’ Networking
- **Fly.io**: `flyctl certs add your-domain.com`

---

## ğŸ“ è·å–å¸®åŠ©

- **æ–‡æ¡£**: æŸ¥çœ‹é¡¹ç›® README.md
- **é—®é¢˜åé¦ˆ**: åœ¨ GitHub æäº¤ Issue
- **æŠ€æœ¯æ”¯æŒ**: è”ç³»å±±ä¸œå’Œæ‹¾æ–¹ä¿¡æ¯ç§‘æŠ€æœ‰é™å…¬å¸

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸå

### è®¿é—®åœ°å€

1. **ç”¨æˆ·ç«¯**: `https://your-domain/`
2. **åå°ç®¡ç†**: `https://your-domain/admin/`
3. **API æ–‡æ¡£**: `https://your-domain/docs`

### é»˜è®¤ç®¡ç†å‘˜è´¦å·

é¦–æ¬¡ä½¿ç”¨éœ€è¦åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼Œè®¿é—® `/admin/register/` æ³¨å†Œï¼š
- ç”¨æˆ·å: `admin`
- å¯†ç : ï¼ˆè‡ªå®šä¹‰ï¼‰
- Email: ï¼ˆä½ çš„é‚®ç®±ï¼‰

### ä¸‹ä¸€æ­¥

1. ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ
2. æ·»åŠ åŒ»ç”Ÿã€åŒ»é™¢ã€ç—…ç§æ•°æ®
3. é…ç½®æ™¯ç‚¹ä¿¡æ¯
4. è®¾ç½®è´¢åŠ¡ç®¡ç†å‚æ•°
5. å¼€å§‹æ¥å¾…ç”¨æˆ·å’¨è¯¢

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·éšæ—¶åé¦ˆã€‚**
